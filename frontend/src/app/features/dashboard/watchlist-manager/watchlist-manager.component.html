<div hlmCard>
  <div
    hlmCardContent
    class="pt-6"
  >
    <!-- Watchlist Selection and Management -->
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center space-x-2">
        <div
          class="relative"
          [formGroup]="watchlistForm"
        >
          <brn-select formControlName="selectedWatchlist">
            <hlm-select-trigger class="w-[180px]">
              <hlm-select-value>
                <div class="flex items-center">
                  @if (activeWatchlist(); as watchlist) {
                  <span
                    class="inline-block w-3 h-3 rounded-full mr-2 border border-foreground/20"
                    [ngStyle]="{
                      backgroundColor: watchlist.color,
                      borderColor: 'hsl(0, 0%, 20%)'
                    }"
                  ></span>
                  }
                  {{ getSelectedWatchlistName() }}
                </div>
              </hlm-select-value>
            </hlm-select-trigger>
            <hlm-select-content>
              <div class="max-h-[300px] overflow-auto">
                @for (watchlist of watchlists(); track watchlist.id) {
                <hlm-option
                  [value]="watchlist.id"
                  class="relative flex items-center justify-between rounded-sm py-1.5 pl-2 pr-8 text-sm"
                >
                  <div class="flex items-center">
                    <span
                      class="inline-block w-3 h-3 rounded-full mr-2 border border-foreground/20"
                      [ngStyle]="{
                        backgroundColor: watchlist.color,
                        borderColor: 'hsl(0, 0%, 20%)'
                      }"
                    ></span>
                    {{ watchlist.name }}
                  </div>
                </hlm-option>
                }
              </div>
            </hlm-select-content>
          </brn-select>
        </div>

        <!-- Edit Button -->
        <button
          hlmBtn
          variant="outline"
          size="icon"
          class="h-9 w-9"
          (click)="startEditing()"
          [disabled]="!selectedWatchlistId()"
        >
          <lucide-angular
            [img]="editIcon"
            class="w-4 h-4"
          ></lucide-angular>
        </button>

        <!-- Delete Button with Confirmation Dialog -->
        <app-confirmation-dialog
          triggerText=""
          triggerVariant="outline"
          triggerClass="h-9 w-9 text-destructive hover:text-destructive hover:bg-destructive/10"
          [disabled]="!selectedWatchlistId()"
          title="Delete Watchlist"
          [description]="getDeleteConfirmationMessage()"
          confirmText="Delete"
          confirmVariant="destructive"
          cancelText="Cancel"
          (confirmed)="onDeleteConfirmed()"
        >
          <lucide-angular
            [img]="trashIcon"
            class="w-4 h-4"
          ></lucide-angular>
        </app-confirmation-dialog>
      </div>

      <!-- New Watchlist Button -->
      @if (!isCreating()) {
      <button
        hlmBtn
        size="sm"
        (click)="startCreating()"
      >
        <lucide-angular
          [img]="plusIcon"
          class="w-4 h-4 mr-2"
        ></lucide-angular>
        New Watchlist
      </button>
      }
    </div>

    <!-- Create Watchlist Form -->
    @if (isCreating()) {
    <div
      class="space-y-3 border rounded-md p-3 mb-4"
      [formGroup]="createForm"
    >
      <h3 class="font-medium">Create New Watchlist</h3>
      <div class="space-y-3">
        <input
          hlmInput
          formControlName="name"
          type="text"
          placeholder="Watchlist name"
          class="w-full"
        />
        <textarea
          hlmInput
          formControlName="description"
          placeholder="Description (optional)"
          class="w-full resize-y min-h-[60px]"
        ></textarea>
        <div class="flex items-center">
          <brn-select
            formControlName="color"
            class="w-full"
          >
            <hlm-select-trigger>
              <hlm-select-value>
                <div class="flex items-center">
                  <span
                    class="inline-block w-3 h-3 rounded-full mr-2 border border-foreground/20"
                    [ngStyle]="{
                      backgroundColor: createForm.get('color')?.value || '#3b82f6',
                      borderColor: 'hsl(0, 0%, 20%)'
                    }"
                  ></span>
                  {{ getColorLabel(createForm.get("color")?.value || "#3b82f6") }}
                </div>
              </hlm-select-value>
            </hlm-select-trigger>
            <hlm-select-content>
              <div class="max-h-[300px] overflow-auto">
                @for (color of colorOptions; track color.value) {
                <hlm-option
                  [value]="color.value"
                  class="relative flex items-center justify-between rounded-sm py-1.5 pl-2 pr-8 text-sm"
                >
                  <div class="flex items-center">
                    <span
                      class="inline-block w-3 h-3 rounded-full mr-2 border border-foreground/20"
                      [ngStyle]="{
                        backgroundColor: color.value,
                        borderColor: 'hsl(0, 0%, 20%)'
                      }"
                    ></span>
                    {{ color.label }}
                  </div>
                </hlm-option>
                }
              </div>
            </hlm-select-content>
          </brn-select>
        </div>
      </div>
      <div class="flex justify-end space-x-2">
        <button
          hlmBtn
          variant="outline"
          size="sm"
          (click)="cancelCreate()"
        >
          Cancel
        </button>
        <button
          hlmBtn
          size="sm"
          (click)="createWatchlist()"
          [disabled]="!createForm.valid"
        >
          Create
        </button>
      </div>
    </div>
    }

    <!-- Edit Watchlist Form -->
    @if (isEditing()) {
    <div
      class="space-y-3 border rounded-md p-3 mb-4"
      [formGroup]="editForm"
    >
      <h3 class="font-medium">Edit Watchlist</h3>
      <div class="space-y-3">
        <input
          hlmInput
          formControlName="name"
          type="text"
          placeholder="Watchlist name"
          class="w-full"
        />
        <textarea
          hlmInput
          formControlName="description"
          placeholder="Description (optional)"
          class="w-full resize-y min-h-[60px]"
        ></textarea>
        <div class="flex items-center">
          <brn-select
            formControlName="color"
            class="w-full"
          >
            <hlm-select-trigger>
              <hlm-select-value>
                <div class="flex items-center">
                  <span
                    class="inline-block w-3 h-3 rounded-full mr-2 border border-foreground/20"
                    [ngStyle]="{
                      backgroundColor: editForm.get('color')?.value || '#3b82f6',
                      borderColor: 'hsl(0, 0%, 20%)'
                    }"
                  ></span>
                  {{ getColorLabel(editForm.get("color")?.value || "#3b82f6") }}
                </div>
              </hlm-select-value>
            </hlm-select-trigger>
            <hlm-select-content>
              <div class="max-h-[300px] overflow-auto">
                @for (color of colorOptions; track color.value) {
                <hlm-option
                  [value]="color.value"
                  class="relative flex items-center justify-between rounded-sm py-1.5 pl-2 pr-8 text-sm"
                >
                  <div class="flex items-center">
                    <span
                      class="inline-block w-3 h-3 rounded-full mr-2 border border-foreground/20"
                      [ngStyle]="{
                        backgroundColor: color.value,
                        borderColor: 'hsl(0, 0%, 20%)'
                      }"
                    ></span>
                    {{ color.label }}
                  </div>
                </hlm-option>
                }
              </div>
            </hlm-select-content>
          </brn-select>
        </div>
      </div>
      <div class="flex justify-end space-x-2">
        <button
          hlmBtn
          variant="outline"
          size="sm"
          (click)="cancelEdit()"
        >
          <lucide-angular
            [img]="xIcon"
            class="w-4 h-4 mr-2"
          ></lucide-angular>
          Cancel
        </button>
        <button
          hlmBtn
          size="sm"
          (click)="saveEdit()"
          [disabled]="!editForm.valid"
        >
          <lucide-angular
            [img]="checkIcon"
            class="w-4 h-4 mr-2"
          ></lucide-angular>
          Save
        </button>
      </div>
    </div>
    }

    <!-- Add Channel Component -->
    @if (selectedWatchlistId()) {
    <app-add-channel [watchlistId]="selectedWatchlistId()!" />
    }
  </div>
</div>
